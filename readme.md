# üß† MindWeave Backend API - Developer Guide

*[‰∏≠ÊñáÁâàÊú¨Ë´ãË¶ã‰∏ãÊñπ | Traditional Chinese version below](#‰∏≠ÊñáÈñãÁôºËÄÖÊåáÂçó)*

## üìã API Reference for Frontend Developers

**Production Base URL:** `https://mind-be-ruddy.vercel.app`  
**API Version:** v0.2.0  
**Content-Type:** `application/json`  
**Authentication:** JWT Bearer tokens

---

## üöÄ Quick Start

### Step 1: Test Basic Connectivity
```bash
curl https://mind-be-ruddy.vercel.app/api/health
```

### Step 2: Try Guest Mode Analysis
```bash
curl -X POST https://mind-be-ruddy.vercel.app/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"entry_text": "I feel great today and excited about my new project!"}'
```

### Step 3: Register a User and Get Tokens
```bash
curl -X POST https://mind-be-ruddy.vercel.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email": "dev@example.com", "username": "developer"}'
```

---

## üîê Authentication Flow

### 1. User Registration
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",     // optional
  "username": "username123"        // optional (at least one required)
}
```

**Response:**
```json
{
  "user": {
    "user_id": "ce56ee93-eb02-49ec-b68e-9a8e266688d3",
    "email": "user@example.com",
    "username": "username123",
    "display_name": "username123",
    "plan_type": "free",
    "created_at": "2025-07-29T05:50:02.899781+00:00"
  },
  "tokens": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "f4ca06ad-dacf-4956-9f4a-b431e9e9073b"
  },
  "message": "User created successfully"
}
```

### 2. User Login
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**Response:** Same format as registration

### 3. Using JWT Tokens
Include the access token in all authenticated requests:
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## üß† Analysis API

### Guest Mode (No Authentication)
```http
POST /api/analyze
Content-Type: application/json

{
  "entry_text": "Your journal entry text here (max 5000 chars)"
}
```

**Example Response:**
```json
{
  "analysis": {
    "emotions_quantified": {
      "joy": 0.6,
      "excitement": 0.4
    },
    "emotion_polarity": {
      "positive": 1.0,
      "negative": 0.0
    },
    "topics": ["personal_growth", "work"],
    "timestamp": "2025-07-29T05:32:43.148487"
  },
  "mindweave_reflection": "This entry beautifully captures a sense of joy and excitement about new opportunities.",
  "ysym": false,
  "mode": "guest",
  "stored": false,
  "processing_time": 1.52,
  "message": "Register to unlock historical insights!",
  "benefits": [
    "Track emotional patterns over time",
    "Get insights based on your history",
    "Search through past entries"
  ]
}
```

### User Mode (With Authentication & Historical Context)
```http
POST /api/analyze
Content-Type: application/json
Authorization: Bearer your_access_token

{
  "entry_text": "I'm feeling overwhelmed with work again, just like last week.",
  "user_id": "ce56ee93-eb02-49ec-b68e-9a8e266688d3"
}
```

**Example Response:**
```json
{
  "analysis": {
    "emotions_quantified": {
      "overwhelmed": 0.5,
      "stressed": 0.3,
      "anxious": 0.2
    },
    "emotion_polarity": {
      "positive": 0.0,
      "negative": 1.0
    },
    "topics": ["work", "personal_wellbeing"]
  },
  "mindweave_reflection": "This is your 3rd entry about work overwhelm this month. Pattern shows stress typically peaks mid-week, with 85% of similar entries followed by weekend recovery.",
  "ysym": true,
  "ysym_analysis": "You said: feeling overwhelmed with work ‚Üí You meant: I'm afraid I can't meet expectations and might be failing",
  "mode": "user",
  "stored": true,
  "historical_entries_used": 12,
  "processing_time": 4.2
}
```

### YSYM Triggering Logic
- **Triggered when:** `emotion_polarity.negative >= 0.6` (60% or more negative emotions)
- **Response includes:** `ysym_analysis` field with deeper emotional insights

---

## üîç Search API

### Search User's Entries
```http
POST /api/search
Content-Type: application/json
Authorization: Bearer your_access_token

{
  "search_query": "anxious",           // optional - keyword search
  "start_date": "2025-07-01",         // optional - YYYY-MM-DD format
  "end_date": "2025-07-29",           // optional - YYYY-MM-DD format
  "limit": 20                          // optional - max 100, default 50
}
```

**Example Response:**
```json
{
  "results": [
    {
      "entry_id": "cea0d58a-1b94-4c3b-92ff-935d11e70e19",
      "entry_text": "I feel anxious about my presentation tomorrow...",
      "created_at": "2025-07-29T05:51:33.479217+00:00",
      "emotions_quantified": {
        "anxious": 0.8,
        "stressed": 0.2
      },
      "topics": ["work", "social"],
      "relevance_score": 0.0607927
    }
  ],
  "count": 1,
  "search_params": {
    "query": "anxious",
    "start_date": null,
    "end_date": null,
    "limit": 50
  }
}
```

---

## üë§ User Management API

### Get User Profile
```http
GET /api/user/profile
Authorization: Bearer your_access_token
```

**Response:**
```json
{
  "user": {
    "user_id": "ce56ee93-eb02-49ec-b68e-9a8e266688d3",
    "email": "user@example.com",
    "username": "username123",
    "plan_type": "free",
    "created_at": "2025-07-29T05:50:02.899781+00:00"
  },
  "stats": {
    "total_entries_30_days": 15,
    "top_emotions": {
      "happy": 2.4,
      "anxious": 1.8,
      "excited": 1.2
    },
    "top_topics": ["work", "personal_growth", "relationships"]
  }
}
```

### Import Guest Data
```http
POST /api/user/import-guest-data
Content-Type: application/json
Authorization: Bearer your_access_token

{
  "analyses": [
    {
      "entry_text": "Previous guest analysis text",
      "analysis": {
        "emotions_quantified": {"happy": 0.8, "excited": 0.2},
        "emotion_polarity": {"positive": 1.0, "negative": 0.0},
        "topics": ["personal_growth"]
      },
      "mindweave_reflection": "Guest mode reflection text",
      "ysym_analysis": null
    }
  ]
}
```

**Response:**
```json
{
  "imported": 1,
  "failed": 0,
  "total_provided": 1,
  "status": "success"
}
```

---

## üõ†Ô∏è Utility Endpoints

### Health Check
```http
GET /api/health
```

**Response:**
```json
{
  "status": "healthy",
  "timestamp": "2025-07-29T05:32:33.850941",
  "service": "mindweave-reflection-backend",
  "version": "0.2.0",
  "environment": "vercel",
  "integrations": {
    "gemini": "connected",
    "supabase": "connected"
  }
}
```

### Test Endpoint (Sample Analysis)
```http
GET /api/test
```

Returns a complete analysis example with sample data.

### API Information
```http
GET /
```

Returns API documentation and endpoint list.

---

## üíª Frontend Integration Examples

### React TypeScript Hook
```typescript
import { useState, useCallback } from 'react';

interface MindWeaveAPI {
  baseUrl: string;
  authToken?: string;
}

interface AnalysisRequest {
  entry_text: string;
  user_id?: string;
}

interface AnalysisResponse {
  analysis: {
    emotions_quantified: Record<string, number>;
    emotion_polarity: { positive: number; negative: number };
    topics: string[];
    timestamp: string;
  };
  mindweave_reflection: string;
  ysym: boolean;
  ysym_analysis?: string;
  mode: 'guest' | 'user';
  stored: boolean;
  processing_time: number;
}

export const useMindWeaveAPI = ({ baseUrl, authToken }: MindWeaveAPI) => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const apiCall = useCallback(async (endpoint: string, options: RequestInit = {}) => {
    const headers: HeadersInit = {
      'Content-Type': 'application/json',
      ...options.headers,
    };

    if (authToken) {
      headers['Authorization'] = `Bearer ${authToken}`;
    }

    const response = await fetch(`${baseUrl}${endpoint}`, {
      ...options,
      headers,
    });

    const data = await response.json();

    if (!response.ok) {
      throw new Error(data.error || `HTTP ${response.status}`);
    }

    return data;
  }, [baseUrl, authToken]);

  const analyzeEntry = useCallback(async (request: AnalysisRequest): Promise<AnalysisResponse | null> => {
    setLoading(true);
    setError(null);

    try {
      const data = await apiCall('/api/analyze', {
        method: 'POST',
        body: JSON.stringify(request),
      });
      return data;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Analysis failed');
      return null;
    } finally {
      setLoading(false);
    }
  }, [apiCall]);

  const searchEntries = useCallback(async (params: {
    search_query?: string;
    start_date?: string;
    end_date?: string;
    limit?: number;
  }) => {
    setLoading(true);
    setError(null);

    try {
      const data = await apiCall('/api/search', {
        method: 'POST',
        body: JSON.stringify(params),
      });
      return data;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Search failed');
      return null;
    } finally {
      setLoading(false);
    }
  }, [apiCall]);

  const registerUser = useCallback(async (credentials: {
    email?: string;
    username?: string;
  }) => {
    setLoading(true);
    setError(null);

    try {
      const data = await apiCall('/api/auth/register', {
        method: 'POST',
        body: JSON.stringify(credentials),
      });
      return data;
    } catch (err) {
      setError(err instanceof Error ? err.message : 'Registration failed');
      return null;
    } finally {
      setLoading(false);
    }
  }, [apiCall]);

  return {
    analyzeEntry,
    searchEntries,
    registerUser,
    loading,
    error,
  };
};
```

### React Component Example
```typescript
import React, { useState } from 'react';
import { useMindWeaveAPI } from './hooks/useMindWeaveAPI';

const MindWeaveAnalyzer: React.FC = () => {
  const [entryText, setEntryText] = useState('');
  const [result, setResult] = useState<any>(null);
  
  const { analyzeEntry, loading, error } = useMindWeaveAPI({
    baseUrl: 'https://mind-be-ruddy.vercel.app',
    // authToken: localStorage.getItem('mindweave_token') // if user is logged in
  });

  const handleAnalyze = async () => {
    if (!entryText.trim()) return;
    
    const result = await analyzeEntry({ entry_text: entryText });
    if (result) {
      setResult(result);
    }
  };

  return (
    <div className="mindweave-analyzer">
      <textarea
        value={entryText}
        onChange={(e) => setEntryText(e.target.value)}
        placeholder="How are you feeling today?"
        maxLength={5000}
        rows={4}
        className="w-full p-3 border rounded"
      />
      
      <button
        onClick={handleAnalyze}
        disabled={loading || !entryText.trim()}
        className="mt-2 px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
      >
        {loading ? 'Analyzing...' : 'Analyze Entry'}
      </button>

      {error && (
        <div className="mt-2 p-2 bg-red-100 text-red-700 rounded">
          Error: {error}
        </div>
      )}

      {result && (
        <div className="mt-4 space-y-3">
          <div className="p-3 bg-blue-50 rounded">
            <h3 className="font-bold">Emotions:</h3>
            {Object.entries(result.analysis.emotions_quantified).map(([emotion, value]) => (
              <div key={emotion} className="flex justify-between">
                <span>{emotion}:</span>
                <span>{Math.round(value * 100)}%</span>
              </div>
            ))}
          </div>

          <div className="p-3 bg-green-50 rounded">
            <h3 className="font-bold">MindWeave Insight:</h3>
            <p>{result.mindweave_reflection}</p>
          </div>

          {result.ysym && (
            <div className="p-3 bg-purple-50 rounded">
              <h3 className="font-bold">Deeper Analysis (YSYM):</h3>
              <p>{result.ysym_analysis}</p>
            </div>
          )}

          <div className="text-sm text-gray-500">
            Mode: {result.mode} | Processing time: {result.processing_time}s
          </div>
        </div>
      )}
    </div>
  );
};

export default MindWeaveAnalyzer;
```

---

## ‚ö° Performance & Best Practices

### Response Times
- **Guest mode**: 1.5-3 seconds
- **User mode**: 3-5 seconds (includes historical analysis)
- **Search**: 200-500ms
- **Authentication**: 100-300ms

### Rate Limiting Guidelines
- Implement 3-second debounce on analysis requests
- Cache user profile data locally
- Show loading states for better UX

### Error Handling
```typescript
const handleError = (error: string) => {
  if (error.includes('5000 characters')) {
    return 'Entry too long. Please keep under 5000 characters.';
  }
  if (error.includes('token')) {
    return 'Please log in again.';
  }
  if (error.includes('rate limit')) {
    return 'Too many requests. Please wait a moment.';
  }
  return 'Something went wrong. Please try again.';
};
```

---

## üß™ Complete Testing Examples

### Test Suite for Frontend Developers
```javascript
// Test basic connectivity
const testHealth = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/health');
  console.log('Health:', await response.json());
};

// Test guest mode analysis
const testGuestAnalysis = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/analyze', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      entry_text: "I'm feeling excited about this new project but also a bit nervous about the challenges ahead."
    })
  });
  console.log('Guest Analysis:', await response.json());
};

// Test user registration
const testRegistration = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      email: 'test-' + Date.now() + '@example.com',
      username: 'testuser' + Date.now()
    })
  });
  const result = await response.json();
  console.log('Registration:', result);
  return result.tokens?.access_token;
};

// Test user mode analysis
const testUserAnalysis = async (token: string, userId: string) => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/analyze', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      entry_text: "Today was stressful at work, similar to how I felt last week when dealing with the deadline pressure.",
      user_id: userId
    })
  });
  console.log('User Analysis:', await response.json());
};

// Test search functionality
const testSearch = async (token: string) => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/search', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      search_query: 'stress',
      limit: 10
    })
  });
  console.log('Search Results:', await response.json());
};

// Run complete test suite
const runTests = async () => {
  console.log('üß™ Starting MindWeave API Tests...\n');
  
  // Test 1: Health check
  await testHealth();
  
  // Test 2: Guest analysis
  await testGuestAnalysis();
  
  // Test 3: User registration and get token
  const token = await testRegistration();
  
  if (token) {
    // Test 4: User analysis with token
    // Note: Extract user_id from the registration response
    await testUserAnalysis(token, 'user-id-from-registration');
    
    // Test 5: Search
    await testSearch(token);
  }
  
  console.log('\n‚úÖ All tests completed!');
};

// runTests();
```

---

## ‚ùå Error Responses

### Common Error Formats
```json
// 400 Bad Request
{
  "error": "entry_text field is required",
  "status": "error"
}

// 401 Unauthorized
{
  "error": "Invalid token",
  "status": "error"
}

// 500 Internal Server Error
{
  "error": "Internal server error",
  "message": "Analysis temporarily unavailable",
  "status": "error"
}
```

### Error Handling in Frontend
```typescript
const handleApiError = (error: any) => {
  if (error.status === 401) {
    // Redirect to login
    window.location.href = '/login';
  } else if (error.status === 400) {
    // Show validation error
    setErrorMessage(error.error);
  } else {
    // Show generic error
    setErrorMessage('Something went wrong. Please try again.');
  }
};
```

---

# ‰∏≠ÊñáÈñãÁôºËÄÖÊåáÂçó

## üìã ÂâçÁ´ØÈñãÁôºËÄÖ API ÂèÉËÄÉ

**ÁîüÁî¢Áí∞Â¢ÉÂü∫Á§éÁ∂≤ÂùÄ:** `https://mind-be-ruddy.vercel.app`  
**API ÁâàÊú¨:** v0.2.0  
**ÂÖßÂÆπÈ°ûÂûã:** `application/json`  
**Ë∫´‰ªΩÈ©óË≠â:** JWT Bearer ‰ª§Áâå

---

## üöÄ Âø´ÈÄüÈñãÂßã

### Ê≠•È©ü 1: Ê∏¨Ë©¶Âü∫Êú¨ÈÄ£Êé•
```bash
curl https://mind-be-ruddy.vercel.app/api/health
```

### Ê≠•È©ü 2: ÂòóË©¶Ë®™ÂÆ¢Ê®°ÂºèÂàÜÊûê
```bash
curl -X POST https://mind-be-ruddy.vercel.app/api/analyze \
  -H "Content-Type: application/json" \
  -d '{"entry_text": "Êàë‰ªäÂ§©ÊÑüË¶∫ÂæàÊ£íÔºåÂ∞çÊàëÁöÑÊñ∞Â∞àÊ°àÂæàËààÂ•ÆÔºÅ"}'
```

### Ê≠•È©ü 3: Ë®ªÂÜäÁî®Êà∂‰∏¶Áç≤Âèñ‰ª§Áâå
```bash
curl -X POST https://mind-be-ruddy.vercel.app/api/auth/register \
  -H "Content-Type: application/json" \
  -d '{"email": "dev@example.com", "username": "developer"}'
```

---

## üîê Ë∫´‰ªΩÈ©óË≠âÊµÅÁ®ã

### 1. Áî®Êà∂Ë®ªÂÜä
```http
POST /api/auth/register
Content-Type: application/json

{
  "email": "user@example.com",     // ÂèØÈÅ∏
  "username": "username123"        // ÂèØÈÅ∏ÔºàËá≥Â∞ë‰∏ÄÂÄãÂøÖÂ°´Ôºâ
}
```

**ÂõûÊáâÁØÑ‰æã:**
```json
{
  "user": {
    "user_id": "ce56ee93-eb02-49ec-b68e-9a8e266688d3",
    "email": "user@example.com",
    "username": "username123",
    "display_name": "username123",
    "plan_type": "free",
    "created_at": "2025-07-29T05:50:02.899781+00:00"
  },
  "tokens": {
    "access_token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refresh_token": "f4ca06ad-dacf-4956-9f4a-b431e9e9073b"
  },
  "message": "User created successfully"
}
```

### 2. Áî®Êà∂ÁôªÂÖ•
```http
POST /api/auth/login
Content-Type: application/json

{
  "email": "user@example.com"
}
```

**ÂõûÊáâ:** ËàáË®ªÂÜäÁõ∏ÂêåÊ†ºÂºè

### 3. ‰ΩøÁî® JWT ‰ª§Áâå
Âú®ÊâÄÊúâÈúÄË¶ÅÈ©óË≠âÁöÑË´ãÊ±Ç‰∏≠ÂåÖÂê´Ë®™Âïè‰ª§ÁâåÔºö
```http
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## üß† ÂàÜÊûê API

### Ë®™ÂÆ¢Ê®°ÂºèÔºàÁÑ°ÈúÄÈ©óË≠âÔºâ
```http
POST /api/analyze
Content-Type: application/json

{
  "entry_text": "‰Ω†ÁöÑÊó•Ë®òÊ¢ùÁõÆÊñáÂ≠óÔºàÊúÄÂ§ö 5000 Â≠óÂÖÉÔºâ"
}
```

**ÂõûÊáâÁØÑ‰æã:**
```json
{
  "analysis": {
    "emotions_quantified": {
      "joy": 0.6,
      "excitement": 0.4
    },
    "emotion_polarity": {
      "positive": 1.0,
      "negative": 0.0
    },
    "topics": ["personal_growth", "work"],
    "timestamp": "2025-07-29T05:32:43.148487"
  },
  "mindweave_reflection": "ÈÄôÂÄãÊ¢ùÁõÆÁæéÂ•ΩÂú∞ÊçïÊçâ‰∫ÜÂ∞çÊñ∞Ê©üÊúÉÁöÑÂñúÊÇÖÂíåËààÂ•Æ„ÄÇ",
  "ysym": false,
  "mode": "guest",
  "stored": false,
  "processing_time": 1.52,
  "message": "Ë®ªÂÜä‰ª•Ëß£ÈéñÊ≠∑Âè≤Ê¥ûÂØüÂäüËÉΩÔºÅ",
  "benefits": [
    "ËøΩËπ§ÊÉÖÁ∑íÊ®°ÂºèËÆäÂåñ",
    "Âü∫ÊñºÊ≠∑Âè≤ÁöÑÊ¥ûÂØüÂàÜÊûê",
    "ÊêúÂ∞ãÈÅéÂæÄÊ¢ùÁõÆ"
  ]
}
```

### Áî®Êà∂Ê®°ÂºèÔºàÂê´È©óË≠âÂíåÊ≠∑Âè≤ËÑàÁµ°Ôºâ
```http
POST /api/analyze
Content-Type: application/json
Authorization: Bearer your_access_token

{
  "entry_text": "ÊàëÂèàÊÑüÂà∞Â∑•‰ΩúÂ£ìÂäõÂæàÂ§ßÔºåÂ∞±ÂÉè‰∏äÈÄ±‰∏ÄÊ®£„ÄÇ",
  "user_id": "ce56ee93-eb02-49ec-b68e-9a8e266688d3"
}
```

**ÂõûÊáâÁØÑ‰æã:**
```json
{
  "analysis": {
    "emotions_quantified": {
      "overwhelmed": 0.5,
      "stressed": 0.3,
      "anxious": 0.2
    },
    "emotion_polarity": {
      "positive": 0.0,
      "negative": 1.0
    },
    "topics": ["work", "personal_wellbeing"]
  },
  "mindweave_reflection": "ÈÄôÊòØ‰Ω†Êú¨ÊúàÁ¨¨3Ê¨°ÈóúÊñºÂ∑•‰ΩúÂ£ìÂäõÁöÑÊ¢ùÁõÆ„ÄÇÊ®°ÂºèÈ°ØÁ§∫Â£ìÂäõÈÄöÂ∏∏Âú®ÈÄ±‰∏≠ÈÅîÂà∞È´òÂ≥∞Ôºå85%ÁöÑÈ°û‰ººÊ¢ùÁõÆ‰πãÂæåÈÉΩÊúâÈÄ±Êú´ÊÅ¢Âæ©„ÄÇ",
  "ysym": true,
  "ysym_analysis": "‰Ω†Ë™™ÔºöÊÑüÂà∞Â∑•‰ΩúÂ£ìÂäõÂæàÂ§ß ‚Üí ‰Ω†ÊÉ≥Ë°®ÈÅîÔºöÊàëÂÆ≥ÊÄïÁÑ°Ê≥ïÈÅîÂà∞ÊúüÊúõÔºåÂèØËÉΩÊúÉÂ§±Êïó",
  "mode": "user",
  "stored": true,
  "historical_entries_used": 12,
  "processing_time": 4.2
}
```

---

## üîç ÊêúÂ∞ã API

### ÊêúÂ∞ãÁî®Êà∂Ê¢ùÁõÆ
```http
POST /api/search
Content-Type: application/json
Authorization: Bearer your_access_token

{
  "search_query": "ÁÑ¶ÊÖÆ",               // ÂèØÈÅ∏ - ÈóúÈçµÂ≠óÊêúÂ∞ã
  "start_date": "2025-07-01",         // ÂèØÈÅ∏ - YYYY-MM-DD Ê†ºÂºè
  "end_date": "2025-07-29",           // ÂèØÈÅ∏ - YYYY-MM-DD Ê†ºÂºè
  "limit": 20                          // ÂèØÈÅ∏ - ÊúÄÂ§ß 100ÔºåÈ†êË®≠ 50
}
```

**ÂõûÊáâÁØÑ‰æã:**
```json
{
  "results": [
    {
      "entry_id": "cea0d58a-1b94-4c3b-92ff-935d11e70e19",
      "entry_text": "ÊàëÂ∞çÊòéÂ§©ÁöÑÊºîË¨õÊÑüÂà∞ÁÑ¶ÊÖÆ...",
      "created_at": "2025-07-29T05:51:33.479217+00:00",
      "emotions_quantified": {
        "anxious": 0.8,
        "stressed": 0.2
      },
      "topics": ["work", "social"],
      "relevance_score": 0.0607927
    }
  ],
  "count": 1,
  "search_params": {
    "query": "ÁÑ¶ÊÖÆ",
    "start_date": null,
    "end_date": null,
    "limit": 50
  }
}
```

---

## üíª React Êï¥ÂêàÁØÑ‰æã

### React TypeScript Hook
```typescript
import { useState, useCallback } from 'react';

interface MindWeaveAPI {
  baseUrl: string;
  authToken?: string;
}

interface AnalysisRequest {
  entry_text: string;
  user_id?: string;
}

export const useMindWeaveAPI = ({ baseUrl, authToken }: MindWeaveAPI) => {
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const analyzeEntry = useCallback(async (request: AnalysisRequest) => {
    setLoading(true);
    setError(null);

    try {
      const headers: HeadersInit = {
        'Content-Type': 'application/json',
      };

      if (authToken) {
        headers['Authorization'] = `Bearer ${authToken}`;
      }

      const response = await fetch(`${baseUrl}/api/analyze`, {
        method: 'POST',
        headers,
        body: JSON.stringify(request),
      });

      const result = await response.json();

      if (!response.ok) {
        throw new Error(result.error || 'ÂàÜÊûêÂ§±Êïó');
      }

      return result;
    } catch (err) {
      const errorMessage = err instanceof Error ? err.message : 'Êú™Áü•ÈåØË™§';
      setError(errorMessage);
      return null;
    } finally {
      setLoading(false);
    }
  }, [baseUrl, authToken]);

  return { analyzeEntry, loading, error };
};
```

---

## üß™ ÂÆåÊï¥Ê∏¨Ë©¶ÁØÑ‰æã

### ÂâçÁ´ØÈñãÁôºËÄÖÊ∏¨Ë©¶Â•ó‰ª∂
```javascript
// Ê∏¨Ë©¶Âü∫Êú¨ÈÄ£Êé•
const testHealth = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/health');
  console.log('ÂÅ•Â∫∑Ê™¢Êü•:', await response.json());
};

// Ê∏¨Ë©¶Ë®™ÂÆ¢Ê®°ÂºèÂàÜÊûê
const testGuestAnalysis = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/analyze', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      entry_text: "ÊàëÂ∞çÈÄôÂÄãÊñ∞Â∞àÊ°àÊÑüÂà∞ËààÂ•ÆÔºå‰ΩÜ‰πüÂ∞çÂç≥Â∞áÈù¢Ëá®ÁöÑÊåëÊà∞ÊúâÈªûÁ∑äÂºµ„ÄÇ"
    })
  });
  console.log('Ë®™ÂÆ¢Ê®°ÂºèÂàÜÊûê:', await response.json());
};

// Ê∏¨Ë©¶Áî®Êà∂Ë®ªÂÜä
const testRegistration = async () => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/auth/register', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      email: 'test-' + Date.now() + '@example.com',
      username: 'testuser' + Date.now()
    })
  });
  const result = await response.json();
  console.log('Áî®Êà∂Ë®ªÂÜä:', result);
  return result.tokens?.access_token;
};

// Ê∏¨Ë©¶Áî®Êà∂Ê®°ÂºèÂàÜÊûê
const testUserAnalysis = async (token: string, userId: string) => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/analyze', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      entry_text: "‰ªäÂ§©Â∑•‰ΩúÂæàÊúâÂ£ìÂäõÔºåÈ°û‰ººÊñº‰∏äÈÄ±ËôïÁêÜÊà™Ê≠¢Êó•ÊúüÂ£ìÂäõÊôÇÁöÑÊÑüÂèó„ÄÇ",
      user_id: userId
    })
  });
  console.log('Áî®Êà∂Ê®°ÂºèÂàÜÊûê:', await response.json());
};

// Ê∏¨Ë©¶ÊêúÂ∞ãÂäüËÉΩ
const testSearch = async (token: string) => {
  const response = await fetch('https://mind-be-ruddy.vercel.app/api/search', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`
    },
    body: JSON.stringify({
      search_query: 'Â£ìÂäõ',
      limit: 10
    })
  });
  console.log('ÊêúÂ∞ãÁµêÊûú:', await response.json());
};

// Âü∑Ë°åÂÆåÊï¥Ê∏¨Ë©¶Â•ó‰ª∂
const runTests = async () => {
  console.log('üß™ ÈñãÂßã MindWeave API Ê∏¨Ë©¶...\n');
  
  // Ê∏¨Ë©¶ 1: ÂÅ•Â∫∑Ê™¢Êü•
  await testHealth();
  
  // Ê∏¨Ë©¶ 2: Ë®™ÂÆ¢ÂàÜÊûê
  await testGuestAnalysis();
  
  // Ê∏¨Ë©¶ 3: Áî®Êà∂Ë®ªÂÜä‰∏¶Áç≤Âèñ‰ª§Áâå
  const token = await testRegistration();
  
  if (token) {
    // Ê∏¨Ë©¶ 4: ‰ΩøÁî®‰ª§ÁâåÈÄ≤Ë°åÁî®Êà∂ÂàÜÊûê
    // Ê≥®ÊÑèÔºöÂæûË®ªÂÜäÂõûÊáâ‰∏≠ÊèêÂèñ user_id
    await testUserAnalysis(token, 'user-id-from-registration');
    
    // Ê∏¨Ë©¶ 5: ÊêúÂ∞ã
    await testSearch(token);
  }
  
  console.log('\n‚úÖ ÊâÄÊúâÊ∏¨Ë©¶ÂÆåÊàêÔºÅ');
};

// runTests();
```

---

## ‚ùå ÈåØË™§ÂõûÊáâ

### Â∏∏Ë¶ãÈåØË™§Ê†ºÂºè
```json
// 400 ÈåØË™§Ë´ãÊ±Ç
{
  "error": "entry_text field is required",
  "status": "error"
}

// 401 Êú™ÊéàÊ¨ä
{
  "error": "Invalid token",
  "status": "error"
}

// 500 ÂÖßÈÉ®‰º∫ÊúçÂô®ÈåØË™§
{
  "error": "Internal server error",
  "message": "Analysis temporarily unavailable",
  "status": "error"
}
```

### ÂâçÁ´ØÈåØË™§ËôïÁêÜ
```typescript
const handleApiError = (error: any) => {
  if (error.status === 401) {
    // ÈáçÂÆöÂêëÂà∞ÁôªÂÖ•È†ÅÈù¢
    window.location.href = '/login';
  } else if (error.status === 400) {
    // È°ØÁ§∫È©óË≠âÈåØË™§
    setErrorMessage(error.error);
  } else {
    // È°ØÁ§∫ÈÄöÁî®ÈåØË™§
    setErrorMessage('ÁôºÁîüÈåØË™§ÔºåË´ãÁ®çÂæåÂÜçË©¶„ÄÇ');
  }
};
```

---

## ‚ö° ÊïàËÉΩËàáÊúÄ‰Ω≥ÂØ¶Ë∏ê

### ÂõûÊáâÊôÇÈñì
- **Ë®™ÂÆ¢Ê®°Âºè**: 1.5-3 Áßí
- **Áî®Êà∂Ê®°Âºè**: 3-5 ÁßíÔºàÂåÖÂê´Ê≠∑Âè≤ÂàÜÊûêÔºâ
- **ÊêúÂ∞ã**: 200-500 ÊØ´Áßí
- **Ë∫´‰ªΩÈ©óË≠â**: 100-300 ÊØ´Áßí

### ÈÄüÁéáÈôêÂà∂ÊåáÂ∞éÂéüÂâá
- Â∞çÂàÜÊûêË´ãÊ±ÇÂØ¶ÊñΩ 3 ÁßíÈò≤Êäñ
- Êú¨Âú∞Âø´ÂèñÁî®Êà∂Ë≥áÊñô
- È°ØÁ§∫ËºâÂÖ•ÁãÄÊÖã‰ª•ÊîπÂñÑ‰ΩøÁî®ËÄÖÈ´îÈ©ó

### ÈåØË™§ËôïÁêÜÁØÑ‰æã
```typescript
const handleError = (error: string) => {
  if (error.includes('5000 characters')) {
    return 'Ê¢ùÁõÆÂ§™Èï∑„ÄÇË´ã‰øùÊåÅÂú® 5000 Â≠óÂÖÉ‰ª•ÂÖß„ÄÇ';
  }
  if (error.includes('token')) {
    return 'Ë´ãÈáçÊñ∞ÁôªÂÖ•„ÄÇ';
  }
  if (error.includes('rate limit')) {
    return 'Ë´ãÊ±ÇÂ§™È†ªÁπÅ„ÄÇË´ãÁ®çÁ≠âÁâáÂàª„ÄÇ';
  }
  return 'ÁôºÁîüÈåØË™§„ÄÇË´ãÁ®çÂæåÂÜçË©¶„ÄÇ';
};
```

---

## üìö ÂØ¶Èöõ‰ΩøÁî®ÁØÑ‰æã

### React ÁµÑ‰ª∂ÁØÑ‰æã
```typescript
import React, { useState } from 'react';
import { useMindWeaveAPI } from './hooks/useMindWeaveAPI';

const MindWeaveAnalyzer: React.FC = () => {
  const [entryText, setEntryText] = useState('');
  const [result, setResult] = useState<any>(null);
  
  const { analyzeEntry, loading, error } = useMindWeaveAPI({
    baseUrl: 'https://mind-be-ruddy.vercel.app',
    // authToken: localStorage.getItem('mindweave_token') // Â¶ÇÊûúÁî®Êà∂Â∑≤ÁôªÂÖ•
  });

  const handleAnalyze = async () => {
    if (!entryText.trim()) return;
    
    const result = await analyzeEntry({ entry_text: entryText });
    if (result) {
      setResult(result);
    }
  };

  return (
    <div className="mindweave-analyzer">
      <textarea
        value={entryText}
        onChange={(e) => setEntryText(e.target.value)}
        placeholder="‰Ω†‰ªäÂ§©ÊÑüË¶∫Â¶Ç‰ΩïÔºü"
        maxLength={5000}
        rows={4}
        className="w-full p-3 border rounded"
      />
      
      <button
        onClick={handleAnalyze}
        disabled={loading || !entryText.trim()}
        className="mt-2 px-4 py-2 bg-blue-500 text-white rounded disabled:opacity-50"
      >
        {loading ? 'ÂàÜÊûê‰∏≠...' : 'ÂàÜÊûêÊ¢ùÁõÆ'}
      </button>

      {error && (
        <div className="mt-2 p-2 bg-red-100 text-red-700 rounded">
          ÈåØË™§: {error}
        </div>
      )}

      {result && (
        <div className="mt-4 space-y-3">
          <div className="p-3 bg-blue-50 rounded">
            <h3 className="font-bold">ÊÉÖÁ∑íÂàÜÊûê:</h3>
            {Object.entries(result.analysis.emotions_quantified).map(([emotion, value]) => (
              <div key={emotion} className="flex justify-between">
                <span>{emotion}:</span>
                <span>{Math.round(value * 100)}%</span>
              </div>
            ))}
          </div>

          <div className="p-3 bg-green-50 rounded">
            <h3 className="font-bold">MindWeave Ê¥ûÂØü:</h3>
            <p>{result.mindweave_reflection}</p>
          </div>

          {result.ysym && (
            <div className="p-3 bg-purple-50 rounded">
              <h3 className="font-bold">Ê∑±Â∫¶ÂàÜÊûê (YSYM):</h3>
              <p>{result.ysym_analysis}</p>
            </div>
          )}

          <div className="text-sm text-gray-500">
            Ê®°Âºè: {result.mode} | ËôïÁêÜÊôÇÈñì: {result.processing_time}Áßí
          </div>
        </div>
      )}
    </div>
  );
};

export default MindWeaveAnalyzer;
```

---

## üîß ÈñãÁôºÁí∞Â¢ÉË®≠ÁΩÆ

### Áí∞Â¢ÉËÆäÊï∏ÈÖçÁΩÆ
```bash
# .env.local (Next.js) Êàñ .env (React)
NEXT_PUBLIC_MINDWEAVE_API_URL=https://mind-be-ruddy.vercel.app
NEXT_PUBLIC_MINDWEAVE_API_VERSION=v0.2.0
```

### TypeScript È°ûÂûãÂÆöÁæ©
```typescript
// types/mindweave.ts
export interface EmotionAnalysis {
  emotions_quantified: Record<string, number>;
  emotion_polarity: {
    positive: number;
    negative: number;
  };
  topics: string[];
  timestamp: string;
}

export interface AnalysisResponse {
  analysis: EmotionAnalysis;
  mindweave_reflection: string;
  ysym: boolean;
  ysym_analysis?: string;
  mode: 'guest' | 'user';
  stored: boolean;
  processing_time: number;
  historical_entries_used?: number;
  message?: string;
  benefits?: string[];
}

export interface SearchResult {
  entry_id: string;
  entry_text: string;
  created_at: string;
  emotions_quantified: Record<string, number>;
  topics: string[];
  relevance_score: number;
}

export interface User {
  user_id: string;
  email?: string;
  username?: string;
  display_name?: string;
  plan_type: 'free' | 'pro';
  created_at: string;
}

export interface AuthResponse {
  user: User;
  tokens: {
    access_token: string;
    refresh_token: string;
  };
  message: string;
}
```

---

## üì± ÁßªÂãïÁ´ØËÄÉÊÖÆ‰∫ãÈ†Ö

### Fetch API ÈÖçÁΩÆ
```typescript
// ÈÅ©Áî®ÊñºÁßªÂãïÁ´ØÁöÑ fetch ÈÖçÁΩÆ
const fetchWithTimeout = async (url: string, options: RequestInit, timeout = 10000) => {
  const controller = new AbortController();
  const timeoutId = setTimeout(() => controller.abort(), timeout);
  
  try {
    const response = await fetch(url, {
      ...options,
      signal: controller.signal,
    });
    clearTimeout(timeoutId);
    return response;
  } catch (error) {
    clearTimeout(timeoutId);
    throw error;
  }
};
```

### Èõ¢Á∑öÊîØÊè¥
```typescript
// Ê™¢Êü•Á∂≤Ë∑ØÁãÄÊÖã
const isOnline = navigator.onLine;

// Èõ¢Á∑öÊôÇÂÑ≤Â≠òÂàÜÊûêË´ãÊ±Ç
const queueAnalysisRequest = (request: AnalysisRequest) => {
  const queue = JSON.parse(localStorage.getItem('mindweave_queue') || '[]');
  queue.push(request);
  localStorage.setItem('mindweave_queue', JSON.stringify(queue));
};

// Á∂≤Ë∑ØÊÅ¢Âæ©ÊôÇËôïÁêÜ‰ΩáÂàó
const processQueue = async () => {
  const queue = JSON.parse(localStorage.getItem('mindweave_queue') || '[]');
  for (const request of queue) {
    try {
      await analyzeEntry(request);
    } catch (error) {
      console.error('Failed to process queued request:', error);
    }
  }
  localStorage.removeItem('mindweave_queue');
};
```

---

## üöÄ ÈÉ®ÁΩ≤Âª∫Ë≠∞

### Áí∞Â¢ÉÈÖçÁΩÆ
- **ÈñãÁôºÁí∞Â¢É**: `http://localhost:3000`
- **Ê∏¨Ë©¶Áí∞Â¢É**: `https://mind-be-staging.vercel.app`
- **ÁîüÁî¢Áí∞Â¢É**: `https://mind-be-ruddy.vercel.app`

### ÂÆâÂÖ®ËÄÉÈáè
- Ê∞∏ÈÅ†‰∏çË¶ÅÂú®ÂâçÁ´ØÊö¥Èú≤ Supabase Êàñ Gemini API ÂØÜÈë∞
- ‰ΩøÁî® HTTPS ÈÄ≤Ë°åÊâÄÊúâ API ÈÄöË®ä
- ÂØ¶ÊñΩÈÅ©Áï∂ÁöÑ CORS Ë®≠ÁΩÆ
- ÂÆöÊúüËº™Êèõ JWT ÂØÜÈë∞

---

## üìû ÊîØÊè¥ËàáÂïèÈ°åÂõûÂ†±

**‰ΩúËÄÖ**: Gary Yang  
**ÈõªÂ≠êÈÉµ‰ª∂**: gary@agryyang.in  
**‰ª£Á¢ºÂ∫´**: https://github.com/Gary0302/Mind_BE  
**ÂïèÈ°åÂõûÂ†±**: https://github.com/Gary0302/Mind_BE/issues

### ÂõûÂ†± API ÂïèÈ°åÊôÇË´ãÂåÖÂê´
- ‰ΩøÁî®ÁöÑÁ´ØÈªûÂíå HTTP ÊñπÊ≥ï
- Ë´ãÊ±ÇÊ®ôÈ†≠ÂíåÂÖßÂÆπÔºàÂ∑≤ÁßªÈô§ÊïèÊÑüË≥áË®äÔºâ
- ÂÆåÊï¥ÁöÑÈåØË™§ÂõûÊáâ
- ÈáçÁèæÊ≠•È©ü
- ÁÄèË¶ΩÂô®/Áí∞Â¢ÉË≥áË®ä

---
